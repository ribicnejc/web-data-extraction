var bcmsFormErrorCc=0;function bcmsFormValidate(fel,myCallbackFn){try{var hasCallback=!1;if(myCallbackFn&&typeof window[myCallbackFn]=="function"){hasCallback=!0}
$(fel).find("*[type='submit']").attr("disabled",!0);var formName=$(fel).find("input[name='bcmsFormName']").val();$(fel).find(".form-error").slideUp(300,function(){$(this).remove()});$(fel).find(".has-error").removeClass("has-error");var postData={};postData=$(fel).serialize();if($(fel).find("input:file").length>0){$(fel).find("input:file").each(function(){postData+="&"+$(this).attr("name")+"="+encodeURIComponent($(this).val())})}
$.ajax({type:'POST',url:'/admin/js/bcms-form-validate.php',data:postData,dataType:"json",_formEl:fel,_formName:formName,_myCallbackFn:myCallbackFn,_hasCallback:hasCallback,error:function(){$(fel).unbind("submit").removeAttr("onsubmit");$(fel).submit()},success:function(response){if(!response){if(this._hasCallback){if(window[this._myCallbackFn](response,formName,fel)){return!1}}
$(fel).unbind("submit").removeAttr("onsubmit");$(fel).submit()}else if(response&&response.OK&&response.OK==1){if(this._hasCallback){if(window[this._myCallbackFn](response,formName,fel)){return!1}}
$(fel).unbind("submit").removeAttr("onsubmit");$(fel).submit()}else if(response&&response.confirmationAlert){$("html").addClass("bcms-page");$("body").append(response.confirmationAlert)}else if(response){for(i in response){bcmsFormErrorCc++;var errorId="form-error-"+bcmsFormErrorCc;if(i=="ERROR_MSG"){$(fel).prepend("<div class='alert alert-danger form-error' id='"+errorId+"'>"+response[i]+"</div>");$("#"+errorId).hide().slideDown()}else{fieldTrgSelector="*[name='"+i+"']";if($(fel).find(fieldTrgSelector).length==0){fieldTrgSelector="*[name^='"+i+"[']"}
if($(fel).find(fieldTrgSelector).length==0){fieldTrgSelector="*[data-name='"+i+"']"}
if($(fieldTrgSelector).length>0){var errorHtml="<div class='alert alert-danger form-error' id='"+errorId+"'>"+response[i]+"</div>";$(fel).find(fieldTrgSelector+":last").parents(".bcms-form-input:first").append(errorHtml);$(fel).find(fieldTrgSelector).addClass("has-error");$("#"+errorId).hide().slideDown()}}}
$(fel).find(".has-error:first").focus();$(fel).find("*[type='submit']").attr("disabled",!1);if(this._hasCallback){window[this._myCallbackFn](response,formName,fel)}}}})}catch(err){$(fel).unbind("submit").removeAttr("onsubmit");$(fel).submit()}
return!1}
function bcmsFormInit(){bcmsFormDateInit();bcmsFormSelect2Init();if(typeof setupIntFields==="function"&&$("form.js-format-numbers").length>0){setupIntFields("form.js-format-numbers")}
bcmsFormMinMaxOptionsInit();bcmsFormRankFieldsInit()}
function bcmsFormSelect2Init(){if(typeof $.fn.select2!=='undefined'){select2ajax(".bcms-form .select2ajax");$(".bcms-form .chosenJs").select2()}}
function bcmsFormMinMaxOptionsInit(){if($(".bcms-form-options-min-max").length>0){$(".bcms-form-options-min-max input").change(function(){var wrapper=$(this).parents(".bcms-form-options-min-max:first");var maxError=$(wrapper).attr("data-max-error");var max=$(wrapper).attr("data-max-options");if(max&&$(wrapper).find("input:checked").length>max){$(this).attr("checked",!1).prop("checked",!1);alert(maxError)}})}}
$(document).ready(function(){bcmsFormInit()});function bcmsFormDateInit(){var oDate=new Date();var curYear=oDate.getFullYear();if($(".bcms-form .date-picker").length>0&&typeof bcmsStr!="undefined"){$(".bcms-form .date-picker").each(function(){var allowSaturday=!0;var allowSunday=!0;var allowHolidays=!0;var dateMin=null;var dateMax=null;if(typeof $(this).attr("data-allow-saturday")!=="undefined"){allowSaturday=$(this).attr("data-allow-saturday")}
if(typeof $(this).attr("data-allow-sunday")!=="undefined"){allowSunday=$(this).attr("data-allow-sunday")}
if(typeof $(this).attr("data-allow-holidays")!=="undefined"){allowHolidays=$(this).attr("data-allow-holidays")}
if(typeof $(this).attr("data-min-date")!=="undefined"){dateMin=$(this).attr("data-min-date");if(dateMin==0)dateMin=null}
if(typeof $(this).attr("data-max-date")!=="undefined"){dateMax=$(this).attr("data-max-date");if(dateMax==0)dateMax=null}
$(this).datepicker({altFormat:"yy-mm-dd",dateFormat:bcmsStr.dateFormat,changeMonth:!0,changeYear:!0,firstDay:1,minDate:dateMin,maxDate:dateMax,yearRange:(curYear-100)+":"+(curYear+10),showButtonPanel:!0,onSelect:function(dateText,inst){var selected_date=$(this).datepicker("getDate");var dateText=$.datepicker.formatDate("yy-mm-dd",selected_date);var date_input_val=$.datepicker.formatDate(bcmsStr.dateFormat,selected_date);if($(this).parent().find("input[type='hidden']").length){$(this).parent().find("input[type='hidden']").val(dateText)}else{$(this).attr('value',date_input_val);$(this).keyup()}
changeFormDateTime(this);return!1},beforeShow:function(dateText,inst){},beforeShowDay:function(date){var day=date.getDay();if(allowSunday==0&&day==0){return[!1]}
if(allowSaturday==0&&day==6){return[!1]}
return[!0]}})});$(".form-date .date-trigger").click(function(){$(this).parent().find(".date-picker").datepicker("show")})}}
function checkFormDateInput(gel){if($(gel).val()==""||$(gel).val()=="-"){$(gel).prev("input").val("")}else if($(gel).val().length>=8){var cDate=$(gel).datepicker("getDate");if(cDate){var dateStr=cDate.getFullYear()+"-";var day=cDate.getDate();var month=cDate.getMonth()+1;if(day<10){day="0"+day}
if(month<10){month="0"+month}
dateStr+=month+"-"+day;$(gel).prev("input").val(dateStr);if($(gel).parent().parent().find(".time").length>0){changeFormDateTime($(gel).parent().parent().find("*[name='_hh']").get(0))}}}}
function changeFormDateTime(gel){var trg=$(gel).parent().parent();if($(trg).find("*[name='_hh']").length>0){var hh=$(trg).find("*[name='_hh']").val();var mm=$(trg).find("*[name='_mm']").val();var curVal=$(trg).find("input[type='hidden']").val();curVal=curVal.replace(/ ?[0-9]{2}:[0-9]{2}:[0-9]{2}/,'');curVal+=" "+hh+":"+mm+":00";curVal=curVal.replace(/^ /,'');$(trg).find("input[type='hidden']").val(curVal)}
$(trg).find("input[type='hidden']").change()}
function select2initOption(gel,checkForConnected){$.ajax("/admin/js/bcms-form-ajax-search.php",{data:{id:$(gel).val(),fid:$(gel).attr("data-fid"),bcmsFormSessionName:$(".bcms-form input[name='bcmsFormSessionName']").val(),bcmsFormUniqueId:$(".bcms-form input[name='bcmsFormUniqueId']").val(),bcmsFormSessionId:$(".bcms-form input[name='bcmsFormSessionId']").val(),bcmsFormName:$(".bcms-form input[name='bcmsFormName']").val(),bcmsFormSessionPath:$(".bcms-form input[name='bcmsFormSessionPath']").val(),controller:$(gel).attr("data-controller"),valueField:$(gel).attr("data-value-field"),connectedField:$(gel).attr("data-connected-to"),connectedId:$("#my-modal *[name='"+$(gel).attr("data-connected-to")+"']").val()},dataType:"json"}).done(function(data){newId="";newVal="";$(gel).parent().find(".form-select-info").remove();if(data&&data.items&&data.items[0]&&data.items[0].id){newId=data.items[0].id;newVal=data.items[0].text;if(data.items[0].info){$(gel).parent().append(data.items[0].info)}
$(gel).parent().find(".btn-group .btn:first").removeClass("disabled")}else{$(gel).parent().find(".btn-group .btn:first").addClass("disabled");$(gel).parent().find(".select2-container.select2-allowclear").removeClass("select2-allowclear")}
$(gel).val(newId);$(gel).parent().find(".select2-chosen").text(newVal);if(checkForConnected){select2disableConnected(gel)}})}
function select2ajax(selectors){$(selectors).each(function(){var isMultiple=$(this).hasClass("data-multiple");var minimumInputLength=$(this).attr("data-min-input-length");if(!minimumInputLength){minimumInputLength=2}
$(this).select2({minimumInputLength:minimumInputLength,allowClear:!0,escapeMarkup:function(m){return m},multiple:isMultiple,placeholder:$(this).attr("placeholder"),ajax:{url:"/admin/js/bcms-form-ajax-search.php",dataType:'json',data:function(term,page){return{q:term,page_limit:10,page:page,bcmsFormSessionName:$(".bcms-form input[name='bcmsFormSessionName']").val(),bcmsFormUniqueId:$(".bcms-form input[name='bcmsFormUniqueId']").val(),bcmsFormSessionId:$(".bcms-form input[name='bcmsFormSessionId']").val(),bcmsFormName:$(".bcms-form input[name='bcmsFormName']").val(),bcmsFormSessionPath:$(".bcms-form input[name='bcmsFormSessionPath']").val(),fid:$(this).attr("data-fid"),preload:$(this).attr("data-preload"),controller:$(this).attr("data-controller"),controllerParams:$(this).attr("data-controller-params"),action:$(this).attr("data-action"),connectedField:$(this).attr("data-connected-to"),createChoices:$(this).attr("data-create-choices"),additionalData:$(this).attr("data-additional-data"),connectedId:$("#my-modal *[name='"+$(this).attr("data-connected-to")+"']").val(),valueField:$(this).attr("data-value-field"),labelField:$(this).attr("data-label-field"),labelFormat:$(this).attr("data-label-format"),altLabel:$(this).attr("data-alt-label"),}},results:function(data,page){more=!1;if(data.theresMore){more=!0}
return{results:data.items,more:more}},formatSelection:function(object,container){}},formatSelection:function(object,container){return object.text},formatResult:function(res){if(res.new){return res.text+" <span class='label label-success'>"+bcmsStr.Add+"</span>"}else{return res.text}},initSelection:function(element,callback){var id=$(element).val();if($(element).attr("data-create-choices")){var dataEx=id.split(',');[{id:1,text:'test'}];var data=[];for(i in dataEx){data.push({id:dataEx[i],text:dataEx[i]})}
callback(data)}else if(id!==""){$.ajax("/admin/js/bcms-form-ajax-search.php",{data:{id:id,bcmsFormSessionName:$(".bcms-form input[name='bcmsFormSessionName']").val(),bcmsFormSessionId:$(".bcms-form input[name='bcmsFormSessionId']").val(),bcmsFormUniqueId:$(".bcms-form input[name='bcmsFormUniqueId']").val(),bcmsFormName:$(".bcms-form input[name='bcmsFormName']").val(),bcmsFormSessionPath:$(".bcms-form input[name='bcmsFormSessionPath']").val(),fid:$(element).attr("data-fid"),controller:$(element).attr("data-controller"),controllerParams:$(element).attr("data-controller-params"),action:$(element).attr("data-action"),connectedField:$(element).attr("data-connected-to"),additionalData:$(element).attr("data-additional-data"),connectedId:$("#my-modal *[name='"+$(element).attr("data-connected-to")+"']").val(),valueField:$(element).attr("data-value-field"),labelField:$(element).attr("data-label-field"),labelFormat:$(element).attr("data-label-format"),altLabel:$(element).attr("data-alt-label"),},dataType:"json"}).done(function(data){if(data&&data.items){if(data.items.length>1){callback(data.items)}else{callback(data.items[0])}
$(element).parent().find(".form-select-info").remove();if(data.items[0].info){$(element).parent().append(data.items[0].info)}}})}}}).on("select2-open",function(e){if($(e.currentTarget).hasClass("data-preload")){$(e.currentTarget).select2("search","*PRELOAD*");$(".select2-drop-active .select2-input, .select2-dropdown-open .select2-input").val("")}}).on("change",function(e){$(e.currentTarget).parent().find(".form-select-info").remove();if(e.added){$(e.currentTarget).parent().find(".btn-group .btn:first").removeClass("disabled")}else{$(e.currentTarget).parent().find(".btn-group .btn:first").addClass("disabled")}
if(e.added&&e.added.info){$(e.currentTarget).parent().append(e.added.info)}
if($(e.currentTarget).attr("data-on-ajax-change")){onChangeFn=$(e.currentTarget).attr("data-on-ajax-change");if(typeof window[onChangeFn]=="function"){window[onChangeFn](e)}}
var cName=$(e.currentTarget).attr("name");$("*[data-connected-to='"+cName+"']").each(function(){select2initOption(this,1)})})})}
function reloadBcmsForm(gel){var fel=$(gel).parents(".bcms-form:first");var onReload=null;if($(fel).attr("data-on-form-reload")){onReload=$(fel).attr("data-on-form-reload")}
$(fel).find("*[type='submit']").attr("disabled",!0);var postData={};postData=$(fel).serialize();if($(fel).find("input:file").length>0){$(fel).find("input:file").each(function(){postData+="&"+$(this).attr("name")+"="+encodeURIComponent($(this).val())})}
postData+="&bcmsFormReload=1";postData+="&reloadTrigger="+$(gel).attr("name");$.ajax({type:'POST',url:window.location.href,data:postData,dataType:"json",error:function(){},success:function(response){if(typeof response.html!="undefined"){var $f=$(response.html);$(fel).replaceWith($f);bcmsFormInit();if(onReload!==null){var fn=window[onReload];if(typeof fn==='function'){fn($f)}}}}})}
function formRankAddOption(gel){var wrapper=$(gel).parent();var pickedWrapper=$(gel).parents(".form-rank__wrapper:first").find(".form-rank__picked");var maxItems=$(pickedWrapper).attr("data-max-items");var value=$(wrapper).attr("data-value");var name=$(wrapper).attr("data-name");var label=$(wrapper).find(".form-rank__option-label").html();var no=1;var itemsCount=$(pickedWrapper).find(".form-rank__picked-item").length;if(itemsCount){no=itemsCount+1}
if(maxItems&&itemsCount>=maxItems){var maxError=$(pickedWrapper).attr("data-max-error");alert(maxError);return!1}
var html="<div class='form-rank__picked-item' data-value='"+value+"'>";html+="<span class='fa fa-bars form-rank__picked-drag-handle'></span>";html+="<span class='form-rank__picked-no'>"+no+"</span> ";html+="<input name='"+name+"[]' type='hidden' value='"+value+"'>";html+=label;html+="<button type='button' onclick='formRankRemoveOption(this)' class='btn btn-default btn-sm'><i class='fa fa-times'></i></button>";html+="</div>";$(pickedWrapper).append(html);$(wrapper).hide()}
function formRankRemoveOption(gel){var value=$(gel).parent().attr("data-value");var pickedWrapper=$(gel).parents(".form-rank__wrapper:first").find(".form-rank__picked");var optionsWrapper=$(gel).parents(".form-rank__wrapper:first").find(".form-rank__options");$(optionsWrapper).find("label[data-value='"+value+"']").show();$(gel).parent().slideUp(200,function(){$(this).remove();formRankItemsEnumerate(pickedWrapper)})}
function formRankItemsEnumerate(wrapper){var cc=0;$(wrapper).find(".form-rank__picked-item").each(function(){cc++;$(this).find(".form-rank__picked-no").text(cc)})}
function bcmsFormRankFieldsInit(){if($(".form-rank__picked").length>0){$(".form-rank__picked").sortable({axis:'y',items:".form-rank__picked-item",revert:!0,helper:"clone",update:function(event,ui){formRankItemsEnumerate($(ui.item).parents(".form-rank__picked:first"))},})}}
function bcmsFormSubmissionConfirm(confirm,id,fid){var form=$("#js-"+fid);if(confirm){$(form).find("input[name='bcmsFormSubmissionConfirmed']").val(1);bcmsFormValidate(form)}
$("#"+id).remove();$(".bcms-overlay__backdrop, .bcms-overlay-wrapper").remove();$(form).find("*[type='submit']").attr("disabled",!1)}